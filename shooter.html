<!DOCTYPE html>
<html>
<head>
    <title>3D Shooter Mobile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border: 2px solid red; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 10; }
        
        /* Тугмаҳои идоракунӣ барои телефон */
        .joystick-container { position: absolute; bottom: 30px; left: 30px; display: grid; grid-template-columns: repeat(3, 60px); gap: 5px; z-index: 20; }
        .control-btn { width: 60px; height: 60px; background: rgba(255,255,255,0.2); border: 1px solid white; border-radius: 10px; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; user-select: none; }
        
        #shootBtn { position: absolute; bottom: 30px; right: 30px; width: 80px; height: 80px; background: rgba(255,0,0,0.4); border: 2px solid white; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-weight: bold; z-index: 20; }
    </style>
</head>
<body>
    <div id="crosshair"></div>
    
    <!-- Тугмаҳои ҳаракат -->
    <div class="joystick-container">
        <div></div><div class="control-btn" id="btnUp">⬆️</div><div></div>
        <div class="control-btn" id="btnLeft">⬅️</div><div></div><div class="control-btn" id="btnRight">➡️</div>
        <div></div><div class="control-btn" id="btnDown">⬇️</div><div></div>
    </div>

    <!-- Тугмаи тирпарронӣ -->
    <div id="shootBtn">FIRE</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, moveF = false, moveB = false, moveL = false, moveR = false;
        let bullets = [];

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
            scene.add(light);

            // Замин
            const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshPhongMaterial({color: 0x333333}));
            floor.rotation.x = -Math.PI/2;
            scene.add(floor);

            // Душманҳо (Қуттиҳо)
            for(let i=0; i<15; i++) {
                let enemy = new THREE.Mesh(new THREE.BoxGeometry(2,2,2), new THREE.MeshPhongMaterial({color: 0xff0000}));
                enemy.position.set(Math.random()*40-20, 1, Math.random()*40-20);
                scene.add(enemy);
            }

            camera.position.y = 1.5;

            // Функсияҳои пахши тугмаҳо (Touch Events)
            const setupBtn = (id, varName) => {
                const el = document.getElementById(id);
                el.ontouchstart = () => { window[varName] = true; };
                el.ontouchend = () => { window[varName] = false; };
            };
            
            setupBtn('btnUp', 'moveF'); setupBtn('btnDown', 'moveB');
            setupBtn('btnLeft', 'moveL'); setupBtn('btnRight', 'moveR');
            document.getElementById('shootBtn').ontouchstart= shoot;

            // Камера бо даст (Touch Move)
            let lastX;
            document.ontouchmove = (e) => {
                let touch = e.touches[0];
                if (lastX) camera.rotation.y -= (touch.pageX - lastX) * 0.01;
                lastX = touch.pageX;
            };
            document.ontouchend = () => { lastX = null; };
            camera.rotation.order = 'YXZ';
        }

        function shoot() {
            let bullet = new THREE.Mesh(new THREE.SphereGeometry(0.1), new THREE.MeshBasicMaterial({color: 0xffff00}));
            bullet.position.copy(camera.position);
            let dir = new THREE.Vector3();
            camera.getWorldDirection(dir);
            bullet.velocity = dir.multiplyScalar(0.8);
            bullets.push(bullet);
            scene.add(bullet);
        }

        function animate() {
            requestAnimationFrame(animate);
            let speed = 0.1;
            let dir = new THREE.Vector3();
            camera.getWorldDirection(dir); dir.y = 0; dir.normalize();

            if(moveF) camera.position.addScaledVector(dir, speed);
            if(moveB) camera.position.addScaledVector(dir, -speed);
            
            bullets.forEach((b, i) => {
                b.position.add(b.velocity);
                if(b.position.length() > 100) { scene.remove(b); bullets.splice(i, 1); }
            });
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
